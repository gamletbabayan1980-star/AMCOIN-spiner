<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AMCOIN Clicker</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    :root {
      --color-bg: #121212;
      --color-primary: #00bfa5;
      --color-primary-dark: #008e75;
      --color-text: #eee;
      --color-accent: #ffb300;
      --color-energy-full: #4caf50;
      --color-energy-low: #f44336;
      --transition: 0.3s ease;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--color-bg);
      color: var(--color-text);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      user-select: none;
    }
    #logo {
      width: 140px;
      margin-bottom: 20px;
      filter: drop-shadow(0 0 6px var(--color-primary));
    }
    header {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      width: 100%;
      max-width: 420px;
      margin-bottom: 20px;
    }
    #langSelect {
      background: var(--color-primary-dark);
      border: none;
      color: var(--color-text);
      padding: 8px 12px;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background var(--transition);
    }
    #langSelect:hover {
      background: var(--color-primary);
    }
    main {
      text-align: center;
      max-width: 420px;
      width: 100%;
      background: #1e1e1e;
      border-radius: 12px;
      padding: 25px 20px 40px;
      box-shadow: 0 0 20px rgba(0, 191, 165, 0.3);
    }
    #welcomeText {
      font-weight: 600;
      font-size: 1.3rem;
      margin-bottom: 15px;
    }
    #counter {
      font-size: 4rem;
      font-weight: 700;
      color: var(--color-accent);
      margin: 15px 0 10px;
      letter-spacing: 2px;
      user-select: text;
    }
    #clickBtn {
      width: 100%;
      font-size: 1.6rem;
      padding: 15px 0;
      background: var(--color-primary);
      border: none;
      border-radius: 10px;
      color: var(--color-text);
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px var(--color-primary-dark);
      transition: all var(--transition);
      user-select: none;
    }
    #clickBtn.low-energy {
      opacity: 0.6;
      cursor: not-allowed;
    }
    #clickBtn:active:not(.low-energy) {
      box-shadow: none;
      transform: translateY(4px);
    }
    #loginBtn {
      margin-top: 20px;
      width: 100%;
      font-size: 1.1rem;
      padding: 12px 0;
      background: transparent;
      border: 2px solid var(--color-primary);
      color: var(--color-primary);
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
      user-select: none;
    }
    #loginBtn:hover {
      background: var(--color-primary);
      color: var(--color-text);
    }
    #balance {
      margin-top: 15px;
      font-size: 1rem;
      color: var(--color-primary);
      user-select: text;
      min-height: 22px;
    }
    #energyContainer {
      margin: 25px 0 15px;
      background: #333;
      border-radius: 30px;
      height: 22px;
      width: 100%;
      max-width: 400px;
      overflow: hidden;
      box-shadow: inset 0 0 6px #0008;
      user-select: none;
    }
    #energyBar {
      height: 100%;
      background: var(--color-energy-full);
      width: 100%;
      max-width: 100%;
      transition: width 0.3s ease, background-color 0.3s ease;
      border-radius: 30px 0 0 30px;
    }
    #energyText {
      margin-top: -22px;
      font-size: 0.9rem;
      color: var(--color-text);
      font-weight: 600;
      user-select: none;
    }
    footer {
      margin-top: auto;
      font-size: 0.8rem;
      color: #555;
      user-select: none;
      max-width: 420px;
      width: 100%;
      text-align: center;
    }
    @media (max-width: 480px) {
      #counter {
        font-size: 3rem;
      }
      #clickBtn {
        font-size: 1.3rem;
      }
      main {
        padding: 20px 15px 30px;
      }
    }
  </style>
</head>
<body>

<header>
  <select id="langSelect" aria-label="Select language">
    <option value="ru">Русский</option>
    <option value="en">English</option>
    <option value="hy">Հայերեն</option>
  </select>
</header>

<main>
  <img id="logo" src="https://i.postimg.cc/jjGMZTC1/generated-image-2ce8a2bb716611ef.png" alt="AMCOIN Logo" />
  <div id="welcomeText"></div>
  <div id="counter">0</div>

  <div id="energyContainer" aria-label="Energy bar">
    <div id="energyBar"></div>
  </div>
  <div id="energyText"></div>

  <button id="clickBtn" aria-label="Click button"></button>

  <button id="loginBtn" aria-label="Login with TON wallet"></button>

  <div id="balance" aria-live="polite"></div>
</main>

<footer>
  AMCOIN Clicker — Demo game &copy; 2025
</footer>

<script>
  const translations = {
    ru: {
      welcome: 'Добро пожаловать в AMCOIN Clicker!',
      click: 'Кликни меня!',
      login: 'Войти через TON-кошелек',
      balance: 'Баланс AMCOIN: ',
      loggedIn: 'Вы вошли как: ',
      loginError: 'Ошибка авторизации. Попробуйте снова.',
      energy: 'Энергия: ',
      walletNotFound: 'Кошелек Tonkeeper не найден. Установите расширение.',
      loadingBalance: 'загружается...'
    },
    en: {
      welcome: 'Welcome to AMCOIN Clicker!',
      click: 'Click me!',
      login: 'Login with TON Wallet',
      balance: 'AMCOIN Balance: ',
      loggedIn: 'Logged in as: ',
      loginError: 'Authorization error. Try again.',
      energy: 'Energy: ',
      walletNotFound: 'Tonkeeper wallet not found. Please install it.',
      loadingBalance: 'loading...'
    },
    hy: {
      welcome: 'Բարի գալուստ AMCOIN կլիքերին!',
      click: 'Սեղմիր ինձ!',
      login: 'Մուտք TON դրամապանակով',
      balance: 'AMCOIN հաշվեկշիռը՝ ',
      loggedIn: 'Մուտք գործեցիք՝ ',
      loginError: 'Մուտքի սխալ։ Փորձեք նորից։',
      energy: 'Էներգիա՝ ',
      walletNotFound: 'Tonkeeper դրամապանակը չի գտնվել։ Տեղադրեք այն։',
      loadingBalance: 'բեռնվում է...'
    }
  };

  let lang = 'ru';
  let count = 0;
  const energyMax = 100;
  let energy = energyMax;
  const energyConsumption = 15;
  const energyRecoveryRate = 10; // per second → 2 per 200ms
  let userAddress = null;

  const langSelect = document.getElementById('langSelect');
  const welcomeText = document.getElementById('welcomeText');
  const clickBtn = document.getElementById('clickBtn');
  const loginBtn = document.getElementById('loginBtn');
  const counterElem = document.getElementById('counter');
  const balanceElem = document.getElementById('balance');
  const energyBar = document.getElementById('energyBar');
  const energyText = document.getElementById('energyText');

  function shortenAddress(addr) {
    if (!addr || addr.length < 12) return addr;
    return addr.substring(0, 6) + '...' + addr.substring(addr.length - 4);
  }

  function updateTexts() {
    welcomeText.textContent = translations[lang].welcome;
    clickBtn.textContent = translations[lang].click;
    loginBtn.textContent = userAddress
      ? translations[lang].loggedIn + shortenAddress(userAddress)
      : translations[lang].login;
    balanceElem.textContent = userAddress 
      ? translations[lang].balance + translations[lang].loadingBalance
      : '';
    energyText.textContent = translations[lang].energy + Math.floor(energy) + ' / ' + energyMax;
  }

  langSelect.addEventListener('change', e => {
    lang = e.target.value;
    updateTexts();
  });

  function updateCounter() {
    counterElem.textContent = count;
  }

  function updateEnergyBar() {
    const percent = (energy / energyMax) * 100;
    energyBar.style.width = percent + '%';

    if (percent > 50) {
      energyBar.style.backgroundColor = 'var(--color-energy-full)';
    } else if (percent > 20) {
      energyBar.style.backgroundColor = '#ffc107';
    } else {
      energyBar.style.backgroundColor = 'var(--color-energy-low)';
    }

    energyText.textContent = translations[lang].energy + Math.floor(energy) + ' / ' + energyMax;

    // Update button state
    if (energy < energyConsumption) {
      clickBtn.classList.add('low-energy');
    } else {
      clickBtn.classList.remove('low-energy');
    }
  }

  clickBtn.addEventListener('click', () => {
    if (energy < energyConsumption) return;

    count++;
    energy = Math.max(0, energy - energyConsumption);
    updateCounter();
    updateEnergyBar();
  });

  // Add shake animation
  const styleSheet = document.createElement("style");
  styleSheet.innerText = `
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
  `;
  document.head.appendChild(styleSheet);

  // Energy recovery
  setInterval(() => {
    if (energy < energyMax) {
      energy += energyRecoveryRate / 5; // 10 / 5 = 2 per 200ms → 10/sec
      if (energy > energyMax) energy = energyMax;
      updateEnergyBar();
    }
  }, 200);

  async function loginTonkeeper() {
    try {
      if (!(window.ton && window.ton.isTonkeeper)) {
        balanceElem.textContent = translations[lang].walletNotFound;
        return;
      }

      const response = await window.ton.send('ton_requestAccounts');
      if (response && response.length > 0) {
        userAddress = response[0];
        updateTexts();

        // Simulate balance fetch
        setTimeout(() => {
          if (userAddress) {
            balanceElem.textContent = translations[lang].balance + '12345.6789 AMCOIN';
          }
        }, 1000);
      } else {
        balanceElem.textContent = translations[lang].loginError;
      }
    } catch (e) {
      balanceElem.textContent = translations[lang].loginError;
      console.error('Login error:', e);
    }
  }

  loginBtn.addEventListener('click', () => {
    if (userAddress) {
      // Copy address to clipboard
      navigator.clipboard.writeText(userAddress).catch(() => {});
      // Optional: show visual feedback (e.g., tooltip) – omitted for simplicity
    } else {
      loginTonkeeper();
    }
  });

  // Initialize
  updateTexts();
  updateCounter();
  updateEnergyBar();
</script>

</body>
</html>
