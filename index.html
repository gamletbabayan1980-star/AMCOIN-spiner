<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>AMCOIN</title>
<style>
body { margin:0; overflow:hidden; background:#041226; color:#fff; font-family:sans-serif; }
canvas { display:block; background:#061024; }
#ui { position:absolute; top:10px; left:10px; z-index:10; }
#ui div { margin-bottom:4px; }
#menu { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.6); padding:20px; border-radius:12px; text-align:center; }
#menu input { padding:6px 10px; border-radius:6px; border:none; margin-bottom:10px; }
#menu button { padding:6px 12px; border-radius:6px; border:none; cursor:pointer; background:#4d96ff; color:#fff; font-weight:bold; }
</style>
</head>
<body>
<div id="ui">
  <div id="score">Очки: 0</div>
  <div id="leaderboard"><b>Топ:</b></div>
</div>
<div id="menu">
  <div>Введите имя:</div>
  <input id="nameInput" type="text" placeholder="Игрок">
  <br>
  <button id="startBtn">Старт</button>
</div>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let w=window.innerWidth,h=window.innerHeight;
canvas.width=w; canvas.height=h;
window.addEventListener('resize',()=>{w=window.innerWidth;h=window.innerHeight;canvas.width=w;canvas.height=h;});

function rand(a,b){return a+Math.random()*(b-a);}
function randomColor(){const c=['#ff6b6b','#ffd166','#06d6a0','#4d96ff','#c792ea','#ff8fab'];return c[Math.floor(Math.random()*c.length)];}

class Spinner {
  constructor(name,x,y,isPlayer=false){
    this.name=name; this.x=x; this.y=y;
    this.vx=0; this.vy=0;
    this.radius=18+Math.random()*12;
    this.mass=this.radius*this.radius;
    this.color=randomColor();
    this.isPlayer=isPlayer;
    this.spin=Math.random()*Math.PI*2;
    this.spinSpeed=2+Math.random()*4;
    this.alive=true;
  }
  update(dt){
    this.x+=this.vx*dt; this.y+=this.vy*dt;
    this.vx*=0.98; this.vy*=0.98;
    if(this.x<this.radius){this.x=this.radius;this.vx*=-0.4;}
    if(this.y<this.radius){this.y=this.radius;this.vy*=-0.4;}
    if(this.x>w-this.radius){this.x=w-this.radius;this.vx*=-0.4;}
    if(this.y>h-this.radius){this.y=h-this.radius;this.vy*=-0.4;}
    this.spin+=this.spinSpeed*dt;
  }
  draw(ctx){
    ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.spin);
    ctx.beginPath(); ctx.arc(0,0,this.radius,0,Math.PI*2); ctx.fillStyle=this.color; ctx.fill();
    ctx.strokeStyle="#fff"; ctx.lineWidth=2; ctx.stroke(); ctx.restore();
    ctx.fillStyle="#fff"; ctx.font=`${Math.max(10,this.radius*0.5)}px sans-serif`; ctx.textAlign='center';
    ctx.fillText(this.name,this.x,this.y-this.radius-8); ctx.fillText(Math.round(this.mass),this.x,this.y+this.radius+12);
  }
}

let player=null;
let bots=[];
let pointer={x:0,y:0,down:false};
let keys={w:0,a:0,s:0,d:0};
let leaderboard=[];

window.addEventListener('keydown',e=>{if(e.key==='w')keys.w=1;if(e.key==='s')keys.s=1;if(e.key==='a')keys.a=1;if(e.key==='d')keys.d=1;});
window.addEventListener('keyup',e=>{if(e.key==='w')keys.w=0;if(e.key==='s')keys.s=0;if(e.key==='a')keys.a=0;if(e.key==='d')keys.d=0;});
canvas.addEventListener('pointerdown',e=>{pointer.down=true;pointer.x=e.clientX;pointer.y=e.clientY;});
canvas.addEventListener('pointermove',e=>{pointer.x=e.clientX;pointer.y=e.clientY;});
canvas.addEventListener('pointerup',()=>{pointer.down=false;});

function spawnGame(name){
  player=new Spinner(name,w/2,h/2,true);
  bots=[]; for(let i=0;i<8;i++){bots.push(new Spinner('Bot'+(i+1),rand(50,w-50),rand(50,h-50)));}
  leaderboard=[];
}

function handleCollisions(arr){
  for(let i=0;i<arr.length;i++){
    for(let j=i+1;j<arr.length;j++){
      const a=arr[i],b=arr[j];
      const dx=b.x-a.x,dy=b.y-a.y,dist=Math.hypot(dx,dy);
      if(dist<a.radius+b.radius){
        let winner=a.mass>=b.mass?a:b; let loser=winner===a?b:a;
        let transfer=loser.mass*0.7; winner.mass+=transfer; winner.radius=Math.sqrt(winner.mass);
        loser.mass-=transfer; loser.radius=Math.sqrt(loser.mass);
        if(loser.mass<24)loser.alive=false;
        const overlap=(a.radius+b.radius)-dist;
        const nx=dx/dist,ny=dy/dist;
        a.x-=nx*overlap*0.5;a.y-=ny*overlap*0.5; b.x+=nx*overlap*0.5;b.y+=ny*overlap*0.5;
      }
    }
  }
}

function update(dt){
  if(!player) return;
  let ax=keys.d-keys.a, ay=keys.s-keys.w;
  if(pointer.down){ax+=pointer.x-player.x>0?1:-1; ay+=pointer.y-player.y>0?1:-1;}
  let len=Math.hypot(ax,ay)||1;
  player.vx+=ax/len*200*dt; player.vy+=ay/len*200*dt;
  player.update(dt);
  bots.forEach(b=>{
    if(!b.alive) return;
    let target=Math.random()<0.02?player:bots[Math.floor(Math.random()*bots.length)];
    let dx=target.x-b.x, dy=target.y-b.y, d=Math.hypot(dx,dy)||1;
    b.vx+=(dx/d*80*dt); b.vy+=(dy/d*80*dt); b.update(dt);
  });
  handleCollisions([player,...bots.filter(b=>b.alive)]);
  document.getElementById('score').innerText='Очки: '+Math.round(player.mass);
  updateLeaderboard();
}

function draw(){
  if(!player) return;
  ctx.clearRect(0,0,w,h);
  [player,...bots.filter(b=>b.alive)].forEach(sp=>sp.draw(ctx));
}

function updateLeaderboard(){
  const top=[player,...bots.filter(b=>b.alive)].sort((a,b)=>b.mass-a.mass).slice(0,5);
  const lbDiv=document.getElementById('leaderboard');
  lbDiv.innerHTML='<b>Топ:</b><br>'+top.map(sp=>sp.name+': '+Math.round(sp.mass)).join('<br>');
}

let last=performance.now();
function loop(t){ let dt=(t-last)/1000; last=t; update(dt); draw(); requestAnimationFrame(loop); }

document.getElementById('startBtn').addEventListener('click',()=>{
  const nameInput=document.getElementById('nameInput').value.trim()||'Игрок';
  spawnGame(nameInput);
  document.getElementById('menu').style.display='none';
  last=performance.now();
  requestAnimationFrame(loop);
});
</script>
</body>
</html>
