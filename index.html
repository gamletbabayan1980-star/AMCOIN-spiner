<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>AMCOIN Spinner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; overflow:hidden; background:#041226; color:#fff; font-family:sans-serif; touch-action: none; }
canvas { display:block; background:#061024; }
#ui { position:absolute; top:10px; left:10px; z-index:10; }
#menu { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.6); padding:20px; border-radius:12px; text-align:center; }
#menu input { padding:6px 10px; border-radius:6px; border:none; margin-bottom:10px; width:120px; text-align:center;}
#menu button { padding:6px 12px; border-radius:6px; border:none; cursor:pointer; background:#4d96ff; color:#fff; font-weight:bold; }
.button-control { position:absolute; bottom:20px; width:60px; height:60px; background:rgba(77,150,255,0.6); border-radius:50%; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:20px; user-select:none; }
#up{left:50%; transform:translateX(-50%);}
#left{left:30%;}
#right{right:30%;}
#boost{right:10%;}
</style>
</head>
<body>
<div id="ui">
  <div id="score">Очки: 0</div>
  <div id="leaderboard"><b>Топ:</b></div>
</div>
<div id="menu">
  <div>Введите имя:</div>
  <input id="nameInput" type="text" placeholder="Игрок">
  <br>
  <button id="startBtn">Старт</button>
</div>
<div id="up" class="button-control">↑</div>
<div id="left" class="button-control">←</div>
<div id="right" class="button-control">→</div>
<div id="boost" class="button-control">⚡</div>
<canvas id="game"></canvas>
<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
let w=window.innerWidth,h=window.innerHeight;
canvas.width=w; canvas.height=h;
window.addEventListener('resize',()=>{w=window.innerWidth;h=window.innerHeight;canvas.width=w;canvas.height=h;});

function rand(a,b){return a+Math.random()*(b-a);}
function randomColor(){const c=['#ff6b6b','#ffd166','#06d6a0','#4d96ff','#c792ea','#ff8fab'];return c[Math.floor(Math.random()*c.length)];}

class Spinner {
  constructor(name,x,y,isPlayer=false){
    this.name=name; this.x=x; this.y=y;
    this.vx=0; this.vy=0;
    this.radius=20+Math.random()*10;
    this.mass=this.radius*this.radius;
    this.color=randomColor();
    this.isPlayer=isPlayer;
    this.angle=Math.random()*Math.PI*2; // вращение
    this.spinSpeed=10+Math.random()*10;
    this.alive=true;
  }
  update(dt){
    this.x+=this.vx*dt; this.y+=this.vy*dt;
    this.vx*=0.98; this.vy*=0.98;
    if(this.x<this.radius){this.x=this.radius;this.vx*=-0.4;}
    if(this.y<this.radius){this.y=this.radius;this.vy*=-0.4;}
    if(this.x>w-this.radius){this.x=w-this.radius;this.vx*=-0.4;}
    if(this.y>h-this.radius){this.y=h-this.radius;this.vy*=-0.4;}
    this.angle+=this.spinSpeed*dt;
  }
  draw(ctx){
    ctx.save();
    ctx.translate(this.x,this.y);
    ctx.rotate(this.angle);
    // рисуем 3 лопасти
    for(let i=0;i<3;i++){
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.lineTo(this.radius,0);
      ctx.lineWidth=4;
      ctx.strokeStyle=this.color;
      ctx.stroke();
      ctx.rotate(Math.PI*2/3);
    }
    ctx.restore();
    ctx.fillStyle="#fff";
    ctx.font=`${Math.max(10,this.radius*0.5)}px sans-serif`; ctx.textAlign='center';
    ctx.fillText(this.name,this.x,this.y-this.radius-8);
    ctx.fillText(Math.round(this.mass),this.x,this.y+this.radius+12);
  }
}

class Bonus {
  constructor(x,y,type){
    this.x=x; this.y=y; this.radius=10; this.type=type;
    this.color=type==='boost'?'#ffd166':'#06d6a0';
    this.alive=true;
  }
  draw(ctx){
    ctx.beginPath(); ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
    ctx.fillStyle=this.color; ctx.fill(); ctx.strokeStyle="#fff"; ctx.stroke();
  }
}

let player=null;
let bots=[];
let bonuses=[];
let pointer={x:0,y:0,down:false};
let keys={up:0,left:0,right:0,boost:0};
let leaderboard=[];

function spawnGame(name){
  player=new Spinner(name,w/2,h/2,true);
  bots=[]; for(let i=0;i<8;i++){bots.push(new Spinner('Bot'+(i+1),rand(50,w-50),rand(50,h-50)));}
  bonuses=[]; for(let i=0;i<5;i++){bonuses.push(new Bonus(rand(50,w-50),rand(50,h-50),Math.random()<0.5?'boost':'points'));}
  leaderboard=[];
}

function handleCollisions(arr){
  for(let i=0;i<arr.length;i++){
    for(let j=i+1;j<arr.length;j++){
      const a=arr[i],b=arr[j];
      const dx=b.x-a.x,dy=b.y-a.y,dist=Math.hypot(dx,dy);
      if(dist<a.radius+b.radius){
        let winner=a.mass>=b.mass?a:b; let loser=winner===a?b:a;
        let transfer=loser.mass*0.7; winner.mass+=transfer; winner.radius=Math.sqrt(winner.mass);
        loser.mass-=transfer; loser.radius=Math.sqrt(loser.mass);
        if(loser.mass<24)loser.alive=false;
        const overlap=(a.radius+b.radius)-dist;
        const nx=dx/dist,ny=dy/dist;
        a.x-=nx*overlap*0.5;a.y-=ny*overlap*0.5; b.x+=nx*overlap*0.5;b.y+=ny*overlap*0.5;
      }
    }
  }
}

function handleBonuses(){
  bonuses.forEach(b=>{
    if(!b.alive) return;
    const dx=player.x-b.x, dy=player.y-b.y, d=Math.hypot(dx,dy);
    if(d<player.radius+b.radius){
      if(b.type==='boost'){player.vx*=2; player.vy*=2;} 
      else{player.mass+=20; player.radius=Math.sqrt(player.mass);}
      b.alive=false;
    }
  });
  if(bonuses.filter(b=>b.alive).length<3){
    bonuses.push(new Bonus(rand(50,w-50),rand(50,h-50),Math.random()<0.5?'boost':'points'));
  }
}

function update(dt){
  if(!player) return;
  let ax=keys.right-keys.left, ay=keys.up;
  if(pointer.down){ax+=pointer.x-player.x>0?1:-1; ay+=pointer.y-player.y>0?1:-1;}
  let len=Math.hypot(ax,ay)||1;
  let speed=200*dt; if(keys.boost) speed*=2;
  player.vx+=ax/len*speed; player.vy+=ay/len*speed;
  player.update(dt);
  bots.forEach(b=>{
    if(!b.alive) return;
    let target=Math.random()<0.02?player:bots[Math.floor(Math.random()*bots.length)];
    let dx=target.x-b.x, dy=target.y-b.y, d=Math.hypot(dx,dy)||1;
    b.vx+=(dx/d*80*dt); b.vy+=(dy/d*80*dt); b.update(dt);
  });
  handleCollisions([player,...bots.filter(b=>b.alive)]);
  handleBonuses();
  document.getElementById('score').innerText='Очки: '+Math.round(player.mass);
  updateLeaderboard();
}

function draw(){
  if(!player) return;
  ctx.clearRect(0,0,w,h);
  bonuses.forEach(b=>{if(b.alive)b.draw(ctx);});
  [player,...bots.filter(b=>b.alive)].forEach(sp=>sp.draw(ctx));
}

function updateLeaderboard(){
  const top=[player,...bots.filter(b=>b.alive)].sort((a,b)=>b.mass-a.mass).slice(0,5);
  const lbDiv=document.getElementById('leaderboard');
  lbDiv.innerHTML='<b>Топ:</b><br>'+top.map(sp=>sp.name+': '+Math.round(sp.mass)).join('<br>');
}

let last=performance.now();
function loop(t){ let dt=(t-last)/1000; last=t; update(dt); draw(); requestAnimationFrame(loop); }

document.getElementById('startBtn').addEventListener('click',()=>{
  const nameInput=document.getElementById('nameInput').value.trim()||'Игрок';
  spawnGame(nameInput); document.getElementById('menu').style.display='none';
  last=performance.now(); requestAnimationFrame(loop);
});

// мобильные кнопки
['up','left','right','boost'].forEach(id=>{
  const btn=document.getElementById(id);
  btn.addEventListener('touchstart',()=>{keys[id]=1;});
  btn.addEventListener('touchend',()=>{keys[id]=0;});
});
</script>
</body>
</html>
